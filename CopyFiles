#Parameters
param(
    [string]$source = "C:\temp",
    [string]$destination = "c:\temp\destination"
)

#Functions

#Create a function named CheckFolder that checks for the existence of a specific directory/folder that is passed
#to it as a parameter. Also, include a switch parameter named create. If the directory/folder does not exist and
#the create switch is specified, a new folder should be created using the name of the folder/directory that was
#passed to the function.
function Check-Folder([string]$path, [switch]$create) {
    $exists = Test-Path $path
    if (!$exists -and $create) {
        #create the directory because it doesn't exist
        mkdir $path | Out-Null
        $exists = Test-Path $path
    }
    return $exists
}

#Create a function named DisplayFolderStatistics to display folder statistics for a directory/path that is passed
#to it. Output should include the name of the folder, number of files in the folder, and total size of all files in
#that directory.
function Display-FolderStatus([string]$path){
    $files = Get-ChildItem $path -Recurse | Where-Object {!$_.PSIsContainer}
    $totals = $files | Measure-Object -Property Length -Sum
    $stats = "" | Select-Object Path, Count, Size
    $stats.Path = $path
    $stats.Count = $totals.Count
    $stats.Size = [math]::Round($totals.Sum / 1MB, 2)
    return $stats
}

#Main processing
#a) Test for existence of the source folder (using the CheckFolder function).
$sourceExists = Check-Folder $source
if (!$sourceExists) {
    Write-Host "The source directory is not found. Script cannot continue."
    Exit
}

#b) Test for the existence of the destination folder; create it if it is not found (using the CheckFolder function
#with the â€“create switch).
$destinationExists = Check-Folder $destination -create
if (!$destinationExists) {
    Write-Host "The destination directory is not found. Script cannot continue."
    Exit
}

#c) Copy each file to the appropriate destination.
#get all the files that need to be copied
$files = Get-ChildItem $source -Recurse | Where-Object {!$_.PSIsContainer}

#c-i) Display a message when copying a file. The message should list where the file is being
#moved from and where it is being moved to.
foreach ($file in $files) {
    $ext = $file.Extension.Replace(".", "")
    $extDestDir = "$destination\$ext"
    
    #check if dest folder exists
    $extDestDirExists = Check-Folder $extDestDir -create
    if (!$extDestDirExists) {
        Write-Host "The destination directory is not found. Script cannot continue."
        Exit
    }
    #copy file
    Copy-Item $file.FullName $extDestDir
}

#d) Display each target folder name with the file count and byte count for each folder.
$dirs = Get-ChildItem $destination | Where-Object {$_.PSIsContainer}
foreach ($dir in $dirs) {
    Display-FolderStatus $dir.FullName
}
